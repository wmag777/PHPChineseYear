<?php

class ChinaHoroscope{

    protected array $startDates = [

        '31.01.1900','19.02.1901','08.02.1902','29.01.1903','16.02.1904','04.02.1905','25.01.1906','13.02.1907','02.02.1908','22.01.1909',
        '10.02.1910','30.01.1911','18.02.1912','06.02.1913','26.01.1914','14.02.1915','03.02.1916','23.01.1917','11.02.1918','01.02.1919',
        '20.02.1920','08.02.1921','28.01.1922','16.02.1923','05.02.1924','24.01.1925','13.02.1926','02.02.1927','23.01.1928','10.02.1929',
        '30.01.1930','17.02.1931','06.02.1932','26.01.1933','14.02.1934','04.02.1935','24.01.1936','11.02.1937','31.01.1938','19.02.1939',
        '08.02.1940','27.01.1941','15.02.1942','05.02.1943','25.01.1944','13.02.1945','02.02.1946','22.01.1947','10.02.1948','29.01.1949',
        '17.02.1950','06.02.1951','27.01.1952','14.02.1953','03.02.1954','24.01.1955','12.02.1956','31.01.1957','18.02.1958','08.02.1959',
        '28.01.1960','15.02.1961','05.02.1962','25.01.1963','13.02.1964','02.02.1965','21.01.1966','09.02.1967','30.01.1968','17.02.1969',
        '06.02.1970','27.01.1971','15.02.1972','03.02.1973','23.01.1974','11.02.1975','31.01.1976','18.02.1977','07.02.1978','28.01.1979',
        '16.02.1980','05.02.1981','25.01.1982','13.02.1983','02.02.1984','20.02.1985','09.02.1986','29.01.1987','17.02.1988','06.02.1989',
        '27.01.1990','15.02.1991','04.02.1992','23.01.1993','10.02.1994','31.01.1995','19.02.1996','07.02.1997','28.01.1998','16.02.1999',

        '05.02.2000','24.01.2001','12.02.2002','01.02.2003','22.01.2004','09.02.2005','29.01.2006','18.02.2007','07.02.2008','26.01.2009',
        '14.02.2010','03.02.2011','23.01.2012','10.02.2013','31.01.2014','19.02.2015','08.02.2016','28.01.2017','16.02.2018','05.02.2019',
        '25.01.2020','12.02.2021','01.02.2022','22.01.2023','10.02.2024','29.01.2025','17.02.2026','06.02.2027','26.01.2028','13.02.2029',
        '03.02.2030','23.01.2031','11.02.2032','31.01.2033','19.02.2034','08.02.2035','28.01.2036','15.02.2037','04.02.2038','24.01.2039',
        '12.02.2040','01.02.2041','22.01.2042','10.02.2043','30.01.2044','17.02.2045','06.02.2046','26.01.2047','14.02.2048','02.02.2049',
        '23.01.2050','11.02.2051','01.02.2052','19.02.2053','08.02.2054','28.01.2055','15.02.2056','04.02.2057','24.01.2058','12.02.2059',
        '02.02.2060','21.01.2061','09.02.2062','29.01.2063','17.02.2064','05.02.2065','26.01.2066','14.02.2067','03.02.2068','23.01.2069',
        '11.02.2070','31.01.2071','19.02.2072','07.02.2073','27.01.2074','15.02.2075','05.02.2076','24.01.2077','12.02.2078','02.02.2079',
        '22.01.2080','09.02.2081','29.01.2082','17.02.2083','06.02.2084','26.01.2085','14.02.2086','03.02.2087','24.01.2088','10.02.2089',
        '30.01.2090','18.02.2091','07.02.2092','27.01.2093','15.02.2094','05.02.2095','25.01.2096','12.02.2097','01.02.2098','21.01.2099',

        ];

/**    start from 1900 year, repeat every 12 years **/

    protected array $yearNamesRU = ['Мышь','Корова','Тигр','Заяц','Дракон','Змея','Конь','Овца','Обезьяна','Петух','Собака','Свинья'];
    protected array $yearNamesEN = ['Rat', 'Ox', 'Tiger', 'Rabbit', 'Dragon', 'Snake', 'Horse', 'Goat', 'Monkey', 'Rooster', 'Dog', 'Pig'];


/**    date format: dd.mm.yyyy  OR  yyyy **/
    public function getNameByUnknownDate($date):string{
        $arr = explode('.',$date);
        /** check date format **/
        return match (count($arr)) {
            1 => $this->getNameByYear($arr[0]),
            3 => $this->findRealChineseYear($arr[0], $arr[1], $arr[2]),
            default => 'Wrong Date Format',
        };
    }

    private function getNameByYear($year):string{
        $count = 0;
        if($year>2099 || $year<1900)return 'Wrong Year';
        foreach ($this->startDates as $value){
            if(mb_strripos($value,$year)!==false){
                break;
            }
            $count++;
            if($count===12)$count=0;
        }
/**      Here is coming the real name, so, if you need English, just use $this->yearNamesEN instead of $this->yearNameRU **/
        return $this->yearNamesRU[$count];
    }

    private function findRealChineseYear($dd, $mm, $year):string{
        /** so, here is main point for us - is to check, does Chinese year are already started or still not **/
        foreach ($this->startDates as $value){
            if(mb_strripos($value,$year)!==false){
                $startDateArr = explode('.',$value);
                if($mm>$startDateArr[1]) return $this->getNameByYear($year);
                if($mm === $startDateArr[1] && $dd>$startDateArr[0]) return $this->getNameByYear($year);
                return $this->getNameByYear((int)$year-1);
            }
        }
        return 'Wrong Date';
    }

}
